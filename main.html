<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Main</title>
  <link rel="stylesheet" href="main.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebaseAPI.js"></script>
  <script src="backButton.js"></script>

</head>
<body>
  <button id="backButton" onclick="backOnePage()">back</button>

  <div id="container">
    <div id="climb-types">
      <h2>Select your type of climbing</h2>      
    </div>
    <div id="climb-areas-container"></div>


  </div>

  <script>

    var typesContainer = document.getElementById("climb-types"); 
    var radioButtons = document.createElement("div");
    var climbAreasContainer = document.getElementById("climb-areas-container");

    // Vancouver, Squamish and Whistler collections in db
    var van = db.collection("climbingAreas").doc("Vancouver");
    var squam = db.collection("climbingAreas").doc("Squamish");
    var whis = db.collection("climbingAreas").doc("Whistler");

    // Creates trad, bouldering and climbing buttons
    typeRadioButton("trad", "Trad");
    typeRadioButton("bouldering", "Bouldering");
    typeRadioButton("sport", "Sport Climbing");

    var tradButton = document.getElementsByClassName("trad-button");
    tradButton[0].style.display = "none";
    tradButton[1].style.display = "none";

    var boulderingButton = document.getElementsByClassName("bouldering-button");
    boulderingButton[0].style.display = "none";
    boulderingButton[1].style.display = "none";

    var sportButton = document.getElementsByClassName("sport-button");
    sportButton[0].style.display = "none";
    sportButton[1].style.display = "none";

    firebase.auth().onAuthStateChanged((user) => {

      var uid = user.uid;

      if (user) {

        var userClimbingType = db.collection("users").doc(uid);

        // Depending on user info in db, which show the selected button
        userClimbingType.get().then((doc) => {
          // Makes trad radio button (if user climbs trad)
          if (doc.data().trad) {
            tradButton[0].style.display = "initial";
            tradButton[1].style.display = "initial";
            // document.getElementById("bouldering").style.display = "none";
            // document.getElementById("sport").style.display = "none";
            // typeRadioButton("trad", "Trad");
            console.log("user trad climbs");
          }

          // Makes bouldering radio button (if user boulders)
          if (doc.data().bouldering) {
            boulderingButton[0].style.display = "initial";
            boulderingButton[1].style.display = "initial";
            // document.getElementById("trad").style.display = "none";
            // document.getElementById("sport").style.display = "none";
            // typeRadioButton("bouldering", "Bouldering");
            console.log("user boulders");
          }

          // Makes sport climbing radio button (if user sport climbs)
          if (doc.data().sport) {
            sportButton[0].style.display = "initial";
            sportButton[1].style.display = "initial";
            // document.getElementById("trad").style.display = "none";
            // document.getElementById("bouldering").style.display = "none";
            // typeRadioButton("sport", "Sport Climbing");
            console.log("user sport climbs");
          }
        })

      }
    });

    // Makes each radio button (depending on type of climbing inputted)
    function typeRadioButton(climbType, name) {
      radioButtons.innerHTML = radioButtons.innerHTML + 
      `<input type="radio" name="climbType" value="${climbType}" class="${climbType}-button" id="${climbType}">
      <label class="${climbType}-button" for="${climbType}">${name}</label>
      `;
      typesContainer.append(radioButtons);
    }

    // var vanLi;
    // var squamLi;
    // var whisLi;
    
    // vanLi.innerHTML = `<li id="vancouver" onclick="showVanAreas()"></li>`;
    // squamLi.innerHTML = `<li id="squamish" onclick="showSquamAreas()"></li>`;
    // whisLi.innerHTML = `<li id="whistler" onclick="showWhisAreas()"></li>`;

    var vanLi = document.createElement("li");
    vanLi.setAttribute("id", "vancouver");
    vanLi.setAttribute("onclick", "showVanAreas()")

    var squamLi = document.createElement("li");
    squamLi.setAttribute("id", "squamish");
    squamLi.setAttribute("onclick", "showSquamAreas()");

    var whisLi = document.createElement("li");
    whisLi.setAttribute("id", "whistler");
    whisLi.setAttribute("onclick", "showWhisAreas()");

    climbAreasContainer.appendChild(vanLi);
    climbAreasContainer.appendChild(squamLi);
    climbAreasContainer.appendChild(whisLi);

    van.get().then((doc) => {
      vanLi.innerText = doc.data().name;
    });

    squam.get().then((doc) => {
      squamLi.innerText = doc.data().name;
    });

    whis.get().then((doc) => {
      whisLi.innerText = doc.data().name;
    });


    var docRef = db.collection("climbingAreas").doc("Squamish").collection("Crumpit Woods").doc("The Playground");

    docRef.get().then((doc) => {
      if (doc.exists) {
        console.log(doc.data());
      }
    });

    function showVanAreas() {
      console.log("Van clicked");
      squamLi.style.display = "none";
      whisLi.style.display = "none";


    }

    function capitalize(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Trad, boulder and sport radio buttons by ID's
    var tradButtonId = document.getElementById("trad");
    var boulderButtonId = document.getElementById("bouldering");
    var sportButtonId = document.getElementById("sport");

    var squamClicked = false;

    // Show climbing areas in Squamish
    function showSquamAreas() {

      if (squamClicked) {
        console.log("already clicked");

      } else {

      console.log("Squam clicked");
      // Makes Vancouver and Whistler disappear (hidden)
      vanLi.style.display = "none";
      whisLi.style.display = "none";

      var listLi = [];
      squam.get().then((doc) => {
        for (let i = 0; i < doc.data().areas.length; i++) {
          let cragAreaName = doc.data().areas[i];

          listLi[i] = cragAreaName.toLowerCase().replaceAll(' ', '');;
          let capitalized = capitalize(listLi[i]);

          var iArea = document.createElement("li");
          iArea.setAttribute("id", `${listLi[i]}`);
          iArea.setAttribute("class", "squam-areas");
          iArea.setAttribute("onclick", `show${capitalized}Area()`);
          iArea.innerText = cragAreaName;

          climbAreasContainer.appendChild(iArea);

          squam.get().then((doc) => {
            // vanLi.innerText = doc.data().name;
          });
          
        }
        // console.log(doc.data().areas[0]);
      })

      if (boulderButtonId.checked) {
        console.log("bouldering selected");

        

      }
    

      let cheakamusLi = document.createElement("li");
        cheakamusLi.setAttribute("id", "cheakamus");


      var cheakamusArea = squam.collection("Cheakamus").doc("Electric Ave");

      cheakamusArea.get().then((doc) => {
        // console.log(doc.data());
        // console.log(doc.data().area);

        cheakamusLi.innerText = doc.data().area;





      })

      squamClicked = true;
    }

    }

    function showWhisAreas() {
      vanLi.style.display = "none";
      squamLi.style.display = "none";
      console.log("Whistler clicked");
    }
 

  </script>
  
</body>
</html>