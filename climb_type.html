<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="climb_type.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebaseAPI.js"></script>
  <script src="backButton.js"></script>

  <title>CragIt</title>
</head>
<body>

  <button id="backButton" onclick="backOnePage()">back</button>

  <div id="climb-types">
    <h2>What type of climbing?</h2>
    <label for="trad">
      <input id="trad" type="checkbox" onclick="postTrad()">
      <span>Trad</span>
    </label>
    <label for="bouldering">
      <input id="bouldering" type="checkbox" onclick="postBouldering()">
      <span>Bouldering</span>
    </label>
    <label for="sport">
      <input id="sport" type="checkbox" onclick="postSport()">
      <span>Sport Climbing</span>
    </label>
    <input id="submit-here" type="submit" value="Next" onclick="postClimbing()">
  </div>

  <script>
    var uid;
    var tradButton = document.getElementById("trad");
    var boulderingButton = document.getElementById("bouldering");
    var sportButton = document.getElementById("sport");

    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        uid = user.uid;

        let userClimbingType = db.collection("users").doc(uid);

        userClimbingType.get().then((doc) => {

          if (doc.data().trad) {
            tradButton.checked = true;
            console.log("user trad climbs");
          }

          if (doc.data().bouldering) {
            boulderingButton.checked = true;
            console.log("user boulders");
          }

          if (doc.data().sport) {
            sportButton.checked = true;
            console.log("user sport climbs");
          }

          console.log(doc.data());
        })

      }
    })

    function postTrad() {
      firebase.auth().onAuthStateChanged((user) => {
        uid = user.uid;
        if (user) {
          if (document.getElementById("trad").checked) {
            db.collection("users").doc(uid).update({
              trad: true
            })
          } else {
            db.collection("users").doc(uid).update({
              trad: false
            })
          }
        }
      });
    }

    function postBouldering() {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          if (document.getElementById("bouldering").checked) {
            db.collection("users").doc(uid).update({
              bouldering: true
            })
          } else {
            db.collection("users").doc(uid).update({
              bouldering: false
            })
          }
        }
      });
    }


    function postSport() {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          if (document.getElementById("sport").checked) {
            db.collection("users").doc(uid).update({
              sport: true
            })
          } else {
            db.collection("users").doc(uid).update({
              sport: false
            })
          }
        }
      });
    }

    function postClimbing() {
      window.location.assign("main.html");
    }


          // console.log(db.collection("users").doc(user.uid));
        
          // console.log(userData);

          // currentUser = db.collection("users").doc(uid);

          // currentUser.onSnapshot(userDoc => {
          //   userData = userDoc.data();
          // })
  


  </script>

</body>
</html>