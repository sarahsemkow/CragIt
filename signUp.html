<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="login.css">
  <title>Sign Up</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebaseAPI.js"></script>

</head>
<body>

  <div id="login-container">
    <h2>Welcome to CragIt!</h2>
    <div id="login-form">
      <label for="email">Email</label>
      <input type="text" id="email" name="email" placeholder="Enter email">
      <label for="password">Password</label>
      <input type="text" id="password" name="password" placeholder="Enter password">
      <button id="signUp" onclick="createAccount()">Create Account</button>
      <p>Aready have an account? <a href="login.html">Log In</a></p>
    </div>
  </div>

  <script>

    // window.onload = function() {
    //   location.href = "loading.html";
    // }

    console.log("hello");


    function createAccount() {
      console.log("account created");
      
      var userEmail = document.getElementById("email").value;
      var userPassword = document.getElementById("password").value;

      // Creates a new account by passing the new user's email address 
      // and password to createUserWithEmailAndPassword
      firebase.auth().createUserWithEmailAndPassword(userEmail, userPassword)
      .then((userCredential) => {

        var user = userCredential.user;
        console.log("there");
        console.log(userEmail);

        if (userCredential.additionalUserInfo.isNewUser) {
          db.collection("users").doc(user.uid).set({
            name: user.displayName,
            email: user.email
          }).then(function() {
            console.log("New user added to firestore");
            window.location.assign("climb_type.html");
          })
          .catch(function (error) {
            console.log("Error adding new user: " + error);
          });
        } else {
          return true;
        }
        return false;
        
      })
        // Signed in 
        // ...
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;
        // ..        
      });
    }

    //   firebase.auth().onAuthStateChanged((user) => {
    //     if (user) {
    //       // User is signed in, see docs for a list of available properties
    //       // https://firebase.google.com/docs/reference/js/firebase.User
    //       var uid = user.uid;
    //       // ...
    //     } else {

    //     }
    //       // User is signed out
    //       // ...
    //   });



    //   // same level as current page
    //   // location.href = "climb_type.html";

    //   // page located the root folder
    //   // location.href = "/climb_type.html";
    // }


    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          // User is signed in, see docs for a list of available properties
          // https://firebase.google.com/docs/reference/js/firebase.User
          var uid = user.uid;
          // ...
        } else {

        }
          // User is signed out
          // ...
      });


    function signOut() {

      // To sign out a user
      firebase.auth().signOut().then(() => {
        // Sign-out successful.
        }).catch((error) => {
        // An error happened.
      });
    
    }

    // set an observer on the Auth object
    // can then get the user's basic profile info form the User object



  </script>
  
</body>
</html>